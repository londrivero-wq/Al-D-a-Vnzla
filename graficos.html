<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>USDT Hist√≥rico</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
    margin:0;
    font-family:system-ui;
    background:#0f172a;
    color:#f8fafc;
    padding:20px;
}
.container{
    max-width:420px;
    margin:auto;
}
.card{
    background:#1e293b;
    border-radius:20px;
    padding:20px;
}
.title{
    font-size:20px;
    margin-bottom:15px;
}
.info-box{
    margin-top:20px;
    background:#111827;
    padding:15px;
    border-radius:15px;
}
.price{
    font-size:20px;
    font-weight:600;
}
.sub{
    color:#94a3b8;
    font-size:14px;
}
button{
    margin-top:20px;
    width:100%;
    padding:12px;
    border:none;
    border-radius:15px;
    background:#334155;
    color:white;
}
</style>
</head>

<body>

<div class="container">
<div class="card">

<div class="title">USDT - Hist√≥rico Real Acumulativo</div>

<div style="height:260px;">
<canvas id="chart"></canvas>
</div>

<div class="info-box">
<div class="price" id="price">Cargando...</div>
<div class="sub" id="date"></div>
</div>

</div>

<button onclick="window.location.href='index.html'">‚¨Ö Volver</button>
</div>

<script>

const STORAGE_KEY = "usdt_historial_real";
let chart;

// üî• USA AQU√ç TU MISMA API DEL INDEX
async function obtenerUSDT(){
    const res = await fetch('https://ve.dolarapi.com/v1/dolares');
    const data = await res.json();
    const paralelo = data.find(d => d.fuente === 'paralelo').promedio;
    return parseFloat((paralelo * 1.015).toFixed(2));
}

function formatoFecha(date){
    return date.toISOString().split("T")[0];
}

function cargarHistorial(){
    const data = localStorage.getItem(STORAGE_KEY);
    return data ? JSON.parse(data) : {};
}

function guardarHistorial(data){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
}

async function iniciar(){

    const priceEl = document.getElementById("price");
    const dateEl = document.getElementById("date");

    try{

        const precioActual = await obtenerUSDT();
        const hoyKey = formatoFecha(new Date());

        let historial = cargarHistorial();

        if(!historial[hoyKey]){
            historial[hoyKey] = precioActual;
            guardarHistorial(historial);
        }

        const fechas = Object.keys(historial).sort();
        const valores = fechas.map(f => historial[f]);

        priceEl.innerText =
            precioActual.toLocaleString('es-VE',{
                minimumFractionDigits:2,
                maximumFractionDigits:2
            }) + " Bs";

        dateEl.innerText =
            "Actualizado: " + new Date().toLocaleString();

        if(chart) chart.destroy();

        chart = new Chart(document.getElementById("chart"),{
            type:"line",
            data:{
                labels:fechas,
                datasets:[{
                    data:valores,
                    borderColor:"#22c55e",
                    backgroundColor:"rgba(34,197,94,0.15)",
                    fill:true,
                    tension:.4,
                    pointRadius:4
                }]
            },
            options:{
                responsive:true,
                maintainAspectRatio:false,
                plugins:{legend:{display:false}},
                scales:{
                    y:{beginAtZero:false},
                    x:{}
                }
            }
        });

    }catch(e){
        priceEl.innerText = "Error al cargar precio";
        console.error(e);
    }
}

iniciar();

</script>

</body>
</html>

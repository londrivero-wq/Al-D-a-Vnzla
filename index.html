<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vzla Cash Monitor</title>
<link rel="manifest" href="./manifest.json">
<meta name="theme-color" content="#0f172a">

<style>
:root {
    --bg: #0f172a;
    --card: #1e293b;
    --text: #f8fafc;
    --accent-blue: #3b82f6;
    --accent-usdt: #22c55e;
    --accent-orange: #f59e0b;
    --accent-eur: #a855f7;
}

* { box-sizing: border-box; }

body {
    font-family: system-ui, -apple-system, sans-serif;
    background-color: var(--bg);
    color: var(--text);
    margin: 0;
    min-height: 100vh;
    padding: 20px;
}

/* MENU */
.menu-btn {
    position: fixed;
    top: 15px;
    left: 15px;
    font-size: 26px;
    background: none;
    border: none;
    color: white;
    z-index: 1100;
    cursor: pointer;
}

.side-menu {
    position: fixed;
    top: 0;
    left: 0;
    width: 250px;
    height: 100%;
    background: #111827;
    padding: 70px 20px;
    transform: translateX(-100%);
    transition: transform 0.3s ease;
    z-index: 1200;
}

.side-menu.active {
    transform: translateX(0);
}

.side-menu button {
    display: block;
    width: 100%;
    margin-bottom: 15px;
    padding: 12px;
    background: #1f2937;
    border: none;
    color: white;
    border-radius: 10px;
    cursor: pointer;
    font-weight: 600;
}

.overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.5);
    opacity: 0;
    visibility: hidden;
    transition: 0.3s ease;
    z-index: 1150;
}

.overlay.active {
    opacity: 1;
    visibility: visible;
}

.container {
    width: 100%;
    max-width: 400px;
    margin: auto;
}

.header {
    text-align: center;
    margin-bottom: 25px;
}

h1 {
    margin: 0;
    font-size: 1.7rem;
    color: var(--accent-orange);
}

.card {
    background: var(--card);
    border-radius: 20px;
    padding: 24px;
    margin-bottom: 16px;
    display: flex;
    flex-direction: column;
    transition: all 0.3s ease;
}

.card-header {
    display: flex;
    flex-direction: column;
    cursor: pointer;
}

.label {
    font-size: 0.85rem;
    font-weight: 600;
    opacity: 0.7;
    margin-bottom: 8px;
}

.price {
    font-size: 2.2rem;
    font-weight: 800;
    transition: all 0.4s ease;
}

.bcv .price { color: var(--accent-blue); }
.usdt .price { color: var(--accent-usdt); }
.eur .price { color: var(--accent-eur); }

.tap-text {
    font-size: 0.8rem;
    opacity: 0.6;
    margin-top: 6px;
}

.calc-box {
    margin-top: 15px;
    display: none;
    flex-direction: column;
    gap: 10px;
    animation: fadeIn 0.3s ease;
}

.calc-box input {
    padding: 10px;
    border-radius: 10px;
    border: 2px solid #334155;
    background: #0f172a;
    color: white;
    font-size: 1rem;
    width: 100%;
}

.result {
    font-weight: 700;
    font-size: 1.2rem;
}

.flash-up {
    color: #22c55e !important;
    transform: scale(1.05);
}

.flash-down {
    color: #ef4444 !important;
    transform: scale(1.05);
}

#shareBtn {
    width: 100%;
    margin-top: 10px;
    padding: 14px;
    border-radius: 14px;
    border: none;
    background: #25d366;
    color: white;
    font-weight: 700;
    cursor: pointer;
    transition: 0.3s ease;
}

#shareBtn:hover {
    opacity: 0.9;
    transform: scale(1.02);
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-5px); }
    to { opacity: 1; transform: translateY(0); }
}
</style>
</head>

<body>

<button class="menu-btn" onclick="toggleMenu()">â˜°</button>

<div id="sideMenu" class="side-menu">
    <button onclick="irInicio()">Inicio</button>
    <button onclick="irGraficos()">GrÃ¡ficos</button>
</div>

<div id="overlay" class="overlay" onclick="toggleMenu()"></div>

<div class="container">
    <div class="header">
        <h1>ðŸ‡»ðŸ‡ª Vzla Cash</h1>
        <div id="status-text">Sincronizando...</div>
    </div>

    <!-- BCV -->
    <div class="card bcv">
        <div class="card-header" onclick="toggleCalc('bcv')">
            <span class="label">DÃ³lar BCV</span>
            <span class="price" id="p-bcv">0,00</span>
            <span class="tap-text">Toque para calcular</span>
        </div>
        <div class="calc-box" id="calc-bcv">
            <input type="text" placeholder="Monto en Bs"
                   oninput="calcular(this.value,'bcv', this)"
                   onclick="event.stopPropagation()">
            <div class="result" id="res-bcv">$0,00</div>
        </div>
    </div>

    <!-- EUR -->
    <div class="card eur">
        <div class="card-header" onclick="toggleCalc('eur')">
            <span class="label">Euro BCV</span>
            <span class="price" id="p-eur">0,00</span>
            <span class="tap-text">Toque para calcular</span>
        </div>
        <div class="calc-box" id="calc-eur">
            <input type="text" placeholder="Monto en Bs"
                   oninput="calcular(this.value,'eur', this)"
                   onclick="event.stopPropagation()">
            <div class="result" id="res-eur">â‚¬0,00</div>
        </div>
    </div>

    <!-- USDT -->
    <div class="card usdt">
        <div class="card-header" onclick="toggleCalc('usdt')">
            <span class="label">USDT P2P</span>
            <span class="price" id="p-usdt">0,00</span>
            <span class="tap-text">Toque para calcular</span>
        </div>
        <div class="calc-box" id="calc-usdt">
            <input type="text" placeholder="Monto en Bs"
                   oninput="calcular(this.value,'usdt', this)"
                   onclick="event.stopPropagation()">
            <div class="result" id="res-usdt">â‚®0,00</div>
        </div>
    </div>

    <button id="shareBtn" onclick="compartirWhatsApp()">
        Enviar precios por WhatsApp
    </button>

</div>

<script>
function toggleMenu() {
    document.getElementById("sideMenu").classList.toggle("active");
    document.getElementById("overlay").classList.toggle("active");
}

function irInicio() {
    toggleMenu();
}

function irGraficos() {
    window.location.href = "graficos.html";
}

let precios = { bcv: 0, eur: 0, usdt: 0 };
let preciosPrevios = { bcv: null, eur: null, usdt: null };

async function cargarPrecios() {
    try {
        const res = await fetch("https://api.exchangerate.host/latest?base=USD&symbols=VES,EUR");
        const data = await res.json();

        const dolar = data.rates.VES;
        const euro = data.rates.EUR * dolar; // Convertimos EUR a VES
        const usdt = dolar; // USDT â‰ˆ USD

        actualizarPrecio('bcv', dolar);
        actualizarPrecio('eur', euro);
        actualizarPrecio('usdt', usdt * 1.01);

        document.getElementById('status-text').innerText =
            "Actualizado: " + new Date().toLocaleTimeString();

    } catch (error) {
        document.getElementById('status-text').innerText = "Error de conexiÃ³n";
    }
}

function actualizarPrecio(tipo, nuevoValor) {
    const elemento = document.getElementById('p-' + tipo);

    if (preciosPrevios[tipo] !== null) {
        if (nuevoValor > preciosPrevios[tipo]) animar(elemento, 'flash-up');
        else if (nuevoValor < preciosPrevios[tipo]) animar(elemento, 'flash-down');
    }

    preciosPrevios[tipo] = nuevoValor;
    precios[tipo] = nuevoValor;

    elemento.innerText = formatearNumero(nuevoValor);
}

function animar(elemento, clase) {
    elemento.classList.add(clase);
    setTimeout(() => elemento.classList.remove(clase), 400);
}

function toggleCalc(tipo) {
    const box = document.getElementById("calc-" + tipo);
    const visible = box.style.display === "flex";
    document.querySelectorAll(".calc-box").forEach(c => c.style.display = "none");
    if (!visible) box.style.display = "flex";
}

function calcular(valor, tipo, inputElement) {
    let limpio = valor.replace(/\D/g, '');
    if (limpio === '') limpio = "0";
    let numero = parseInt(limpio) / 100;

    inputElement.value = numero.toLocaleString('es-VE', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
    });

    let precio = precios[tipo];
    if (!precio) return;

    let resultado = numero / precio;

    let simbolo = tipo === "bcv" ? "$" :
                  tipo === "eur" ? "â‚¬" : "â‚®";

    document.getElementById("res-" + tipo).innerText =
        simbolo + formatearNumero(resultado);
}

function compartirWhatsApp() {
    if (!precios.bcv) return;

    const mensaje =
`ðŸ‡»ðŸ‡ª *Vzla Cash Monitor*

ðŸ’µ DÃ³lar BCV: ${formatearNumero(precios.bcv)} Bs
ðŸ’¶ Euro BCV: ${formatearNumero(precios.eur)} Bs
ðŸª™ USDT P2P: ${formatearNumero(precios.usdt)} Bs

ðŸ•’ ${new Date().toLocaleString()}`;

    const url = "https://wa.me/?text=" + encodeURIComponent(mensaje);
    window.open(url, "_blank");
}

function formatearNumero(num) {
    return new Intl.NumberFormat('es-VE', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
    }).format(num);
}

cargarPrecios();
setInterval(cargarPrecios, 300000);


if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('./service-worker.js')
      .then(function(registration) {
        console.log('SW registrado:', registration.scope);
      })
      .catch(function(error) {
        console.log('Error registrando SW:', error);
      });
  });
}
</script>

</body>
                </html>
